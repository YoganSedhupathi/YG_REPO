/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/10.1.9
 * Generated at: 2023-08-21 05:30:55 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.pages;

import jakarta.servlet.*;
import jakarta.servlet.http.*;
import jakarta.servlet.jsp.*;

public final class dataImport_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports,
                 org.apache.jasper.runtime.JspSourceDirectives {

  private static final jakarta.servlet.jsp.JspFactory _jspxFactory =
          jakarta.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.HashSet<>();
    _jspx_imports_packages.add("jakarta.servlet");
    _jspx_imports_packages.add("jakarta.servlet.http");
    _jspx_imports_packages.add("jakarta.servlet.jsp");
    _jspx_imports_classes = null;
  }

  private volatile jakarta.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public boolean getErrorOnELNotFound() {
    return false;
  }

  public jakarta.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
  }

  public void _jspDestroy() {
  }

  public void _jspService(final jakarta.servlet.http.HttpServletRequest request, final jakarta.servlet.http.HttpServletResponse response)
      throws java.io.IOException, jakarta.servlet.ServletException {

    if (!jakarta.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      final java.lang.String _jspx_method = request.getMethod();
      if ("OPTIONS".equals(_jspx_method)) {
        response.setHeader("Allow","GET, HEAD, POST, OPTIONS");
        return;
      }
      if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method)) {
        response.setHeader("Allow","GET, HEAD, POST, OPTIONS");
        response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET, POST or HEAD. Jasper also permits OPTIONS");
        return;
      }
    }

    final jakarta.servlet.jsp.PageContext pageContext;
    jakarta.servlet.http.HttpSession session = null;
    final jakarta.servlet.ServletContext application;
    final jakarta.servlet.ServletConfig config;
    jakarta.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    jakarta.servlet.jsp.JspWriter _jspx_out = null;
    jakarta.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("<!DOCTYPE html>\n");
      out.write("<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\">\n");
      out.write("<html>\n");
      out.write("<head>\n");
      out.write("<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n");
      out.write("<title>Data Import</title>\n");
      out.write("<script src=\"js/jquery/jquery-1.8.3.min.js\"></script>\n");
      out.write("<script src=\"js/jquery/jquery-ui.min.js\"></script>\n");
      out.write("<script src=\"js/jquery/jquery.form.min.js\" type=\"text/javascript\"></script>\n");
      out.write("<link href=\"css/styles.css\" rel=\"stylesheet\" type=\"text/css\" />\n");
      out.write("<link href=\"css/style1.css\" rel=\"stylesheet\" type=\"text/css\" />\n");

	String importId=(String)request.getParameter("type");
	String userCode=(String)request.getParameter("usercode");
	if(userCode!=null){
		userCode=(String)request.getSession().getAttribute(userCode);
	}else{
		userCode="0";
	}

      out.write("\n");
      out.write("</head>\n");
      out.write("<body>\n");
      out.write("	<div class='importdiv'>\n");
      out.write("	<div id='content'>\n");
      out.write("	<div id='navigation' style='width:100%;float:left'>\n");
      out.write("	<ul id=\"header\">\n");
      out.write("	<li class='selected'><a href='#step_1'>\n");
      out.write("		Upload excel file\n");
      out.write("		</a>\n");
      out.write("	</li>\n");
      out.write("	<li><a href='#step_2'>\n");
      out.write("		Map the fields\n");
      out.write("		</a>\n");
      out.write("	</li>\n");
      out.write("	<li><a href='#step_3'>\n");
      out.write("		Import data\n");
      out.write("		</a>\n");
      out.write("	</li>	\n");
      out.write("	</ul>\n");
      out.write("	</div>\n");
      out.write("	<div id=\"step_1\" style='position:relative;width:100%;float:left;height:100%;padding-top:10px'>   	\n");
      out.write("	<form id='impForm' name='ImportForm'  method='POST'  enctype='multipart/form-data' action='dataImport.servlet'>\n");
      out.write("    	<ul class=\"pop_inp_lst\">\n");
      out.write("		<li><b>Data File</b><label>		\n");
      out.write("		<span><input id=\"fileUpload\" name=\"fileUpload\" type=\"file\" />\n");
      out.write("		<input id=\"uid\" name=\"uid\" type=\"hidden\" value=\"0\"/>\n");
      out.write("		<input id=\"impid\" name=\"impid\" type=\"hidden\" value=\"");
      out.print(importId);
      out.write("\"/>\n");
      out.write("		<input id=\"usercode\" name=\"usercode\" type=\"hidden\" value=\"");
      out.print(userCode);
      out.write("\"/>\n");
      out.write("		<input id=\"fileName\" name=\"fileName\" type=\"hidden\" value=\"\"/></span></li>\n");
      out.write("		<li><b></b><span><a class=\"butt_sav\" onclick='uploadFile()'>Next</a></span></li>\n");
      out.write("		</ul>\n");
      out.write("	</form>\n");
      out.write("	</div>	\n");
      out.write("	<div id=\"step_2\" style='display:none;position:relative;width:100%;float:left;padding-top:10px'>\n");
      out.write("	<form id='mappingForm' name='mappingForm'/>	\n");
      out.write("			<div id=\"step_21\">\n");
      out.write("			</div>\n");
      out.write("	</form>			\n");
      out.write("	</div>\n");
      out.write("	<div id=\"step_3\" style='display:none;position:relative;width:100%;float:left;padding-top:10px'>	\n");
      out.write("	<form id='importDataForm' name='importDataForm'/>	\n");
      out.write("			<div id=\"step_31\">\n");
      out.write("			</div>\n");
      out.write("	</form>			\n");
      out.write("	</div>\n");
      out.write("	</div>	\n");
      out.write("	</div>\n");
      out.write("	<div id=\"errorContainer\" style='display:none;z-index:1001;' class=\"errorContainer\">\n");
      out.write("	<div id=\"error\" class=\"error\">\n");
      out.write("		<a id='errorClose' onclick='closeError()' class='close'>&times</a>\n");
      out.write("		<span id='error-message'> check </span>\n");
      out.write("		\n");
      out.write("	</div>\n");
      out.write("	</div>	\n");
      out.write("	 <script>\n");
      out.write("	 function closeError(){\n");
      out.write("		$(\"#errorContainer\").fadeOut();\n");
      out.write("  	}\n");
      out.write("  	function setErrorMessage(err){\n");
      out.write("		$(\"#error-message\").html(err);\n");
      out.write("		if(!$(\"#error\").is(\":visible\")){\n");
      out.write("			runEffect(err);\n");
      out.write("		}\n");
      out.write("  	}\n");
      out.write("  	function runEffect(err) {\n");
      out.write("		$(\"#errorContainer\").show();\n");
      out.write("  	}\n");
      out.write("	 $('.butt_sav').click(function(e){\n");
      out.write("		e.preventDefault();\n");
      out.write("	});\n");
      out.write("	 var migcolumns=null;\n");
      out.write("	 var datacolumns=null;\n");
      out.write("	 var saveData=\"\";\n");
      out.write("	 $(document).ready(function()\n");
      out.write("	{  \n");
      out.write("        $('#impForm').ajaxForm({\n");
      out.write("        beforeSubmit: function() {\n");
      out.write("            setErrorMessage('Uploading the file...pls Wait');\n");
      out.write("        },\n");
      out.write("        success: function(data) {\n");
      out.write("            var columnData=eval('('+data+')');\n");
      out.write("            if(\"Success\"==columnData.data.result){\n");
      out.write("        	var str=\"<table><tr><th style='text-align:center'>Import Field</th><th style='text-align:center'>Excel Field</th></tr>\";\n");
      out.write("            migcolumns=columnData.data.migcolumns;\n");
      out.write("            datacolumns=columnData.data.datacolumns;\n");
      out.write("            var migLen=migcolumns.length;\n");
      out.write("            var sheetLen=datacolumns.length;\n");
      out.write("            for(i=0;i<migLen;i++){\n");
      out.write("            	var styleName=\"\";\n");
      out.write("            	if(migcolumns[i][2]=='1'){\n");
      out.write("            		styleName=\"\";\n");
      out.write("            	}\n");
      out.write("            	str=str+\"<tr><td class='\"+styleName+\"'>\"+migcolumns[i][1]+\"</td><td><select name='mapping' id='\"+migcolumns[i][0]+\"'><option value='-1'>Not Mapped</option>\";\n");
      out.write("            	for(j=0;j<sheetLen;j++){\n");
      out.write("            		if(datacolumns[j][0]==migcolumns[i][3]){\n");
      out.write("            			str=str+\"<option value='\"+datacolumns[j][1]+\"' selected>\"+datacolumns[j][0]+\"</option>\";\n");
      out.write("            		}else{\n");
      out.write("            			str=str+\"<option value='\"+datacolumns[j][1]+\"'>\"+datacolumns[j][0]+\"</option>\";\n");
      out.write("            		}	\n");
      out.write("            	}\n");
      out.write("            	str=str+\"<td></tr>\";\n");
      out.write("            }\n");
      out.write("            $('#uid').attr(\"value\",columnData.data.uploadno);\n");
      out.write("            $('#step_21').html(str);\n");
      out.write("            $('#step_21').append(\"<a class='butt_sav' id='importData' value='Next' onclick='dataImportCall()'>Next</a><a class='butt_can' id='cancel' onclick='cancelAll()'>Cancel</a>\");\n");
      out.write("            closeError();\n");
      out.write("            $('#step_1').css(\"display\",\"none\");\n");
      out.write("            $('#step_2').css(\"display\",\"block\");\n");
      out.write("            $('#header li').eq(0).removeClass('selected');\n");
      out.write("            $('#header li').eq(1).addClass('selected');\n");
      out.write("            }else{\n");
      out.write("            	setErrorMessage(columnData.data.result);\n");
      out.write("            }\n");
      out.write("        }\n");
      out.write("    });\n");
      out.write("})    \n");
      out.write("function uploadFile(){\n");
      out.write("	var importFileName=$.trim($(\"#fileUpload\").val());\n");
      out.write("	if(importFileName.indexOf(\"\\\\\")){\n");
      out.write("		importFileName=importFileName.substr(importFileName.lastIndexOf('\\\\')+1);\n");
      out.write("	}	\n");
      out.write("	var ext=importFileName.substr(importFileName.lastIndexOf('.')+1).toLowerCase();\n");
      out.write("	if(ext=='xls' || ext=='csv'){\n");
      out.write("		$(\"#fileName\").attr(\"value\",importFileName);\n");
      out.write("		$(\"#impForm\").submit();\n");
      out.write("	}else{\n");
      out.write("		alert(\"Please upload xs,csv formats only\");	\n");
      out.write("	}\n");
      out.write("}\n");
      out.write("function dataImportCall(){\n");
      out.write("	var res=validateColumnMapping();\n");
      out.write("	if(\"Success\"==res){\n");
      out.write("		$(\"#mappingForm\").submit();\n");
      out.write("		}else{\n");
      out.write("			alert(res);\n");
      out.write("		}\n");
      out.write("}\n");
      out.write("function validateColumnMapping(){\n");
      out.write("	var result=\"Success\";\n");
      out.write("	var comma=\"\";\n");
      out.write("	saveData='savedata={\"type\":\"mapping\",\"usercode\":\"'+");
      out.print(userCode);
      out.write("+'\",\"importid\":\"'+");
      out.print(importId);
      out.write("+'\",\"uploadid\":\"'+$(\"#uid\").val()+'\",\"filename\":\"'+$(\"#fileName\").val()+'\",\"data\":[';\n");
      out.write("	$.each($('select[name=\"mapping\"]'), function() {\n");
      out.write("		var id=$(this).attr(\"id\");\n");
      out.write("  		if($(this).val()==-1 && migcolumns[id][2]=='1'){\n");
      out.write("			result=\"Mapping for  the field :\"+migcolumns[id][1]+\" is missing. Kindly map the field to continue\"; 			\n");
      out.write("  		}else{\n");
      out.write("  			saveData+=comma+'[\"'+id+'\",\"'+$(this).val()+'\",\"'+$(this).find('option:selected').text()+'\"]';\n");
      out.write("  			comma=\",\";\n");
      out.write("  		}\n");
      out.write("	});\n");
      out.write("	saveData+=\"]}\";\n");
      out.write("	return result;\n");
      out.write("}\n");
      out.write("function cancelAll(){\n");
      out.write("	saveData='savedata={\"type\":\"cancel\",\"usercode\":\"'+");
      out.print(userCode);
      out.write("+'\",\"importid\":\"'+");
      out.print(importId);
      out.write("+'\",\"uploadid\":\"'+$(\"#uid\").val()+'\",\"filename\":\"'+$(\"#fileName\").val()+'\"}';\n");
      out.write("	$.ajax({\n");
      out.write("			url:\"dataImportSave.servlet\",\n");
      out.write("			data:saveData,\n");
      out.write("			type: \"POST\",\n");
      out.write("			success: function(data){\n");
      out.write("			if(\"Success\"==data){\n");
      out.write("					clearScreen(false);\n");
      out.write("				 }else{\n");
      out.write("				 	setErrorMessage(data);\n");
      out.write("				 }\n");
      out.write("				}\n");
      out.write("			});\n");
      out.write("}\n");
      out.write("function clearScreen(save){\n");
      out.write("	if(!save){\n");
      out.write("	 closeError();\n");
      out.write("	 }\n");
      out.write("	 $('#step_21').html(\"\");\n");
      out.write("	 $('#step_31').html(\"\");\n");
      out.write("	 $('#fileName').val(\"\");\n");
      out.write("	 $(\"#fileUpload\").val(\"\");\n");
      out.write("	 $('#step_1').css(\"display\",\"block\");\n");
      out.write("	 $('#step_2').css(\"display\",\"none\");\n");
      out.write("	 $('#step_3').css(\"display\",\"none\");\n");
      out.write("	 $('#header li').eq(0).addClass('selected');\n");
      out.write("	 $('#header li').eq(1).removeClass('selected');\n");
      out.write("	 $('#header li').eq(2).removeClass('selected');\n");
      out.write("}\n");
      out.write("function importAllData(){\n");
      out.write("	saveData='savedata={\"type\":\"save\",\"usercode\":\"'+");
      out.print(userCode);
      out.write("+'\",\"importid\":\"'+");
      out.print(importId);
      out.write("+'\",\"uploadid\":\"'+$(\"#uid\").val()+'\",\"filename\":\"'+$(\"#fileName\").val()+'\"}';\n");
      out.write("	$.ajax({\n");
      out.write("			url:\"dataImportSave.servlet\",\n");
      out.write("			data:saveData,\n");
      out.write("			type: \"POST\",\n");
      out.write("			success: function(data){\n");
      out.write("			if(\"Success\"==data){\n");
      out.write("				 setErrorMessage(\"Data imported Successfully\");\n");
      out.write("				 clearScreen(true);\n");
      out.write("				 }else{\n");
      out.write("				 	setErrorMessage(data);\n");
      out.write("				 }\n");
      out.write("				}\n");
      out.write("			});\n");
      out.write("}\n");
      out.write("$('#mappingForm').submit(function() {\n");
      out.write("		$.ajax({\n");
      out.write("			url:\"dataImportSave.servlet\",\n");
      out.write("			data:saveData,\n");
      out.write("			type: \"POST\",\n");
      out.write("			success: function(data){\n");
      out.write("            		var importDetail=eval('('+data+')');\n");
      out.write("            		if(\"Success\"==importDetail.data.result){\n");
      out.write("	            		var str=\"<table>\";\n");
      out.write("	            		str=str+\"<tr><th colspan='2'><b>Number of Rows ready to be imported : \";\n");
      out.write("	            		var noOfRowstoImport=importDetail.data.rowstoimport;\n");
      out.write("	            		str=str+noOfRowstoImport+\"</b></th></tr>\";\n");
      out.write("	            		var invalidRows=importDetail.data.invalidrows;\n");
      out.write("	            		var len=invalidRows.length;\n");
      out.write("	            		str=str+\"<tr><th colspan='2'><b> Number of invalid Rows : \";\n");
      out.write("	            		str=str+len+\"</b></th>\";\n");
      out.write("	            		if(len>0){\n");
      out.write("		            		str=str+\"<tr><th>Row</th><th>Reason</th></tr>\";\n");
      out.write("		            		for(k=0;k<len;k++){\n");
      out.write("		            			str=str+\"<tr><td>\";\n");
      out.write("		            			str=str+invalidRows[k][0];\n");
      out.write("		            			str=str+\"</td><td>\";\n");
      out.write("		            			str=str+invalidRows[k][1];\n");
      out.write("		            			str=str+\"</tr>\";\n");
      out.write("		            		}\n");
      out.write("		            	}\n");
      out.write("		            	$('#step_31').html(str);\n");
      out.write("		            	$('#step_31').append(\"<a href='#' id='importAll' class='butt_sav' value='Import' onclick='importAllData()'>Import</a><a id='cancel_3' class='butt_can' onclick='cancelAll()'>Cancel</a>\");\n");
      out.write("		            	closeError();\n");
      out.write("           	            $('#step_2').css(\"display\",\"none\");\n");
      out.write("			            $('#step_3').css(\"display\",\"block\");\n");
      out.write("			            $('#header li').eq(2).addClass('selected');\n");
      out.write("			            $('#header li').eq(1).removeClass('selected');\n");
      out.write("		            }else{\n");
      out.write("		            	setErrorMessage(columnData.data.result);\n");
      out.write("		            }\n");
      out.write("				}\n");
      out.write("			});\n");
      out.write("		return false;\n");
      out.write("});\n");
      out.write("</script>\n");
      out.write("</body>\n");
      out.write("</html>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof jakarta.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
